---
title: 检测私有API
date: 2021-01-21 15:17:06
tags: iOS
---

# preg

1. cd到工程根目录



```bash
cd 工程根目录
```

1. 遍历查找关键字



```css
grep 关键字 -r .
以上面的邮件举例的话：”grep com.apple.springboard.complete -r .“
```

此命令会查找根目录以及多级目录以下的所有文件，包括.framework和.a库，找到匹配结果的话，会打印出来。
 -r参数表示会遍历多级目录下的文件。
 注意:-r和.之间有个空格

# strings

首先需要找到app对应的一个Unix可执行文件，可以从两个途径获取这个文件。

#### 工程中获取

1. 在Xcode文件树中搜索“.app”
2. 找到对应文件，右键“Show in Finder”
3. 选中.app文件，右键“显示包内容”
4. 下拉可找到一个跟app名字一致的Unix执行文件

#### ipa文件中获取

1. 将.ipa改变成.zip后缀
2. 解压文件，进入文件夹，进入Payload子文件，找到.app文件
3. 选中.app文件，右键“显示包内容”
4. 下拉可找到一个跟app名字一致的Unix执行文件

#### 查找指令



```undefined
 strings - -a -arch armv7 Unix可执行文件 | grep 关键字
```

-a、-arch、armv7这几个参数作用未知，此处只是做一个简单记录，以后有空再做学习。

# otool

跟strings一样，需要先找到Unix可执行文件，然后运行指令。



```undefined
otool -L Unix可执行文件
```

会打印出工程中用到的系统库，我尝试的结果是只有系统库，可以在打印结果中检查是否引入了私有库。

# nm

跟strings一样，需要先找到Unix可执行文件，然后运行指令。



```undefined
nm Unix可执行文件 | grep 关键字
```

会打印关键字对应的方法调用的位置等，未仔细研究，暂且做记录。

# 检查私有API的开源库

查资料过程中，发现一个开源库iOS-private-api-checker，可以用来检查app是否使用了私有API，并定位调用位置。

进入开源库的GitHub界面，显示“Deprecated”状态，最终测试结果，不能检测出私有API的问题，不知道是否我的配置有问题。

# 总结

在查找“定位调用私有API位置的方法”的过程，发现大多数文章的作者通过grep的方式就可以定位到问题所在。我之所以查找了其他工具的使用方法，是因为我用grep的方式没有查找到问题，最终花了很多时间来查找问题，结果是让人很无奈。
 原因竟然是提交审核的包跟我查找问题的包不是同一份代码，最后用提交审核对应的工程马上就定位到问题了，工作中很多时候，一个异常查找很久没有定位到问题的时候，需要跳出来，考虑一下是否是源头出了问题。